
<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="./../../../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="./../../../layout/shared-styles.html">
<link rel="import" href="./../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="./../../components/format-number-behavior.html">
<link rel="import" href="./../../../redux-behavior.html">

<!--<link rel="import" href="./../../components/custom-grid-zoom.html">-->

<dom-module id="exporter-report-list">
    <template>
        <style include="shared-styles">
             vaadin-grid#material {
                /* height:450px; */
                height: calc(100vh - var(--set-dynamic-height) - 107px);

                --vaadin-grid-header-cell: {
                    font-size: 14px;
                    height: 40px;
                    font-weight: bold;
                }
                --vaadin-grid-body-cell: {
                    font-size: 14px;
                    height: 40px;
                    /*padding:0px;*/
                }
                --vaadin-grid-footer-cell: {
                    font-size: 14px;
                    height: 40px;
                    font-weight: bold;
                }
            }
        </style>
        <!--<custom-grid-zoom>-->
        <vaadin-grid slot="grid" id="material" items="[[data]]" size="200">
            <vaadin-grid-column width="100px" flex-grow="0">
                <template class="header">
                    <div class="cell" style="text-align:center;padding:15px">
                        ลำดับที่
                    </div>
                </template>
                <template>
                    <div class="cell" style="text-align:center;padding:15px">
                        [[count(index)]]
                    </div>
                </template>
            </vaadin-grid-column>
            <vaadin-grid-column width="400px">
                <template class="header">
                    <div class="cell">
                        ผู้ส่งออก
                    </div>
                </template>
                <template>
                    <div class="cell">
                        [[item.exporter_name]]
                    </div>
                </template>
                
                <template class="footer">
                    <div class="cell">
                        รวม
                    </div>
                </template>
                
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">
                    <div class="cell">
                        ปริมาณ (ตัน)
                    </div>
                </template>
                <template>
                    <div class="cell" style="text-align:right">
                        [[formatNumber(item.weight,'0\,0.00000')]]
                    </div>
                </template>
                <template class="footer">
                    <div class="cell" style="text-align:right">
                        [[_sum(data)]]
                    </div>
                </template>
            </vaadin-grid-column>
            <vaadin-grid-column>
                <template class="header">
                    <div class="cell">
                        สถานะเอกสาร
                    </div>
                </template>
                <template>
                    <div class="cell">
                        [[item.type_doc_th]]
                    </div>
                </template>
            </vaadin-grid-column>
            <vaadin-grid-column width="200px" flex-grow="0">
                <template class="header">
                    <div class="cell">
                        จัดการ
                    </div>
                </template>
                <template>
                    <div class="cell">
                        <paper-icon-button on-tap="openPanel" icon="create"></paper-icon-button>
                        <paper-icon-button on-tap="confirmDelete" icon="delete"></paper-icon-button>
                    </div>
                </template>
            </vaadin-grid-column>
        </vaadin-grid>
        <!--</custom-grid-zoom>-->
    </template>
    <script>
        Polymer({
            is: 'exporter-report-list',
            behaviors:[ReduxBehavior,FormatNumberBehavior],
            observers:['getHeight(height)'],
            properties:{
                data:{
                    type:Array,
                    value:[]
                },
                select:{
                    type:Object
                }
            },
            _sum:function(val){
                var i = 0;
                if(val){
                    val.map((item)=>{
                        i += item.weight;
                    });
                }
               
                return this.formatNumber(i,'0,0.00000')
            },
            getHeight: function (h) {
                this.customStyle['--set-dynamic-height'] = h.toString() + 'px';
                //console.log(this.customStyle['--set-dynamic-height'])
                this.updateStyles();

            },
            count:function(val){
                return val+1;
            },
            resize:function(){
                this.$.material.notifyResize();
            },
            checkWeight:function(val){
                if(typeof val.weight == 'undefined'){
                    return this.formatNumber(val.weight);
                }
                else{
                    return this.formatNumber(val.weight)
                }
            },
            confirmDelete:function(e){
                this.fire('toast', {
                    status: 'openDialog',
                    text: 'ต้องการลบข้อมูลใช่หรือไม่ ?',
                    confirmed: this.deleteData.bind(this),
                    data: e.model.item.id
                })
                console.log(e.model.item.id)
            },
            deleteData:function(check,data){
               if(check == true){
                //    console.log(this.select)'
                  this.dispatchAction('EXPORTER_REPORT_DELETE',data.data)
                  .then((res)=>{
                    this.dispatchAction('EXPORTER_REPORT_SEARCH',this.select)
                  })
               } 
            },
            openPanel:function(e){
                console.log('1234')
                // console.log(e.model.item.id);
                // this.dispatchAction('EXPORTER_REPORT_CLEAR_FILE_SELECT')
                this.dispatchAction('EXPORTER_REPORT_CLEAR')
                .then(()=>{
                    console.log(e.model.item)
                    this.dispatchAction('EXPORTER_REPORT_LIST_UPLOAD',e.model.item.exporter_id);
                    this.dispatchAction('EXPORTER_REPORT_SELECT',e.model.item.id);
                    this.dispatchAction('EXPORTER_REPORT_CLEAR_FILE')
                    this.fire('open-panel',{id:e.model.item.id})
                })
                .catch(()=>{

                }) 
                // this.$$('nylon-panel-right').open();
            }
        });
    </script>
</dom-module>