<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../layout/shared-styles.html">
<link rel="import" href="../../../nylon-behavior.html">
<link rel="import" href="../../../redux-behavior.html">
<link rel="import" href="../../components/page-header.html">
<link rel="import" href="../../components/page-panel.html">
<link rel="import" href="../../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="./../../components/nylon-input.html">
<link rel="import" href="./../../components/format-number-behavior.html">

<dom-module id="report-form">
    <template>
        <style include="shared-styles"></style>
        <div class="row around-xs">
            <div class="col-xs-3">
                <div class="box">
                    <vaadin-combo-box class="saveData" label="รายงานการส่งออกข้าวไป EU" items="{{listEu}}" value="{{data.quota}}" error-message="กรุณาเลือกรายการ"
                        item-label-path="name" item-value-path="id" required></vaadin-combo-box>
                </div>
            </div>
            <div class="col-xs-3">
                <div class="box">
                    <vaadin-combo-box label="เดือน" items="[[month]]" item-label-path="name" item-value-path="id" value="{{data.month}}"></vaadin-combo-box>
                </div>
            </div>
            <div class="col-xs-3">
                <div class="box">
                    <vaadin-combo-box items="[[year]]" label="ปี" error-message="กรุณาเลือกปี" value="{{data.year}}" required></vaadin-combo-box>
                </div>
            </div>
        </div>

        <div class="row around-xs">
            <div class="col-xs-3">
                <div class="box">
                    <vaadin-combo-box label="เลือกบริษัท" items="[[company]]" item-label-path="name" item-value-path="id" value="{{data.exporter_id}}" required></vaadin-combo-box>
                </div>
            </div>
            <div class="col-xs-3">
                <div class="box">
                    <vaadin-combo-box label="ความถูกต้องของเอกสาร" items="[[checkDoc]]" item-label-path="name" item-value-path="id" value="{{data.type_doc}}" required></vaadin-combo-box>
                </div>
            </div>
            <div class="col-xs-3">
                <div class="box">
                    <vaadin-combo-box label="ประเภทข้าว" items="[[typeRice]]" item-label-path="type_rice_name_th" item-value-path="id" value="{{data.type_rice_id}}" value="{{data.type_rice_id}}" required></vaadin-combo-box>
                </div>
            </div>
        </div>

        <div class="row around-xs">
            <div class="col-xs-3">
                <div class="box">
                    <nylon-input label="ปริมาณการส่งออก" value="{{data.weight}}" format-number></nylon-input>
                    <!--<paper-input label="ปริมาณการส่งออก" value="{{data.weight}}"></paper-input>-->
                </div>
            </div>
            <div class="col-xs-3">
                <div class="box">
                    <!--<vaadin-combo-box class="saveData" label="ความถูกต้องของเอกสาร" items="[[checkDoc]]" item-label-path="name" item-value-path="id"
                        required></vaadin-combo-box>-->
                </div>
            </div>
            <div class="col-xs-3">
                <div class="box">
                    <!--<vaadin-combo-box class="saveData" label="ประเภทข้าว" required></vaadin-combo-box>-->
                </div>
            </div>
        </div>

        <div class="row end-xs">
            <div class="col-xs-6">
                <div class="box section" style="text-align:right">
                    <!--<paper-button raised on-tap="confirmData">Delete</paper-button>-->
                    <paper-button raised class="gl-btn-danger btn">ยกเลิก</paper-button>
                    <paper-button on-tap="saveData" raised class="gl-btn-success btn">บันทึก</paper-button>
                </div>
            </div>
        </div>
    </template>
    <script>
        Polymer({
            is: 'report-form',
            behaviors: [ReduxBehavior,FormatNumberBehavior],
            properties: {
                data:{
                   statePath:'report.data'
                },
                listEu: {
                    type: Array,
                    value: [
                        {
                            id: 'true',
                            name: 'ในโควตา'
                        },
                        {
                            id: 'false',
                            name: 'นอกโควตา'
                        }
                    ]
                },
                checkDoc: {
                    type: Array,
                    value: [
                        {
                            id: 'c',
                            name: 'ถูกต้องตามประกาศ'
                        },
                        {
                            id: 'ic',
                            name: 'ไม่ถููกต้องตามประกาศ'
                        },
                        {
                            id: 'od',
                            name: 'เอกสารเกินกำหนด'
                        }
                    ]
                },
                month: {
                    statePath: 'commonData.month'
                },
                typeRice: {
                    statePath: 'commonData.type_rice'
                },
                year:{
                    statePath: 'commonData.year',
                    // observer: 'setYear'
                },
                company:{
                    statePath: 'commonData.company'
                }
            },
            setYear:function(year){
                console.log(year);
                this.newYear = year.map(function(item){
                    var newItem = {
                        id: item,
                        name: item.toString()
                    }
                    return newItem;
                })
                console.log(this.newYear);
            },
            saveData:function(){
                var newQuota = false;
                if(this.data.quota == 'true'){
                    newQuota = true
                }
                var newData = {
                    quota : newQuota,
                    month : parseInt(this.data.month),
                    year : parseInt(this.data.year),
                    exporter_id : this.data.exporter_id,
                    type_doc : this.data.type_doc,
                    type_rice_id:this.data.type_rice_id,
                    weight: this.unFormat(this.data.weight)
                }
                // console.log(newData);
                if(typeof this.data.id == 'undefined'){
                     this.dispatchAction('REPORT_INSERT',this,newData);
                }
                else{
                    newData.id = this.data.id;
                    // console.log(newData);
                    this.dispatchAction('REPORT_UPDATE',this,newData);
                }
                
            }
        });
    </script>
</dom-module>