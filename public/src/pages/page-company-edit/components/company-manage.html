<link rel="import" href="./../../components/validateFormBehaviors.html">
<link rel="import" href="./../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="./../../../../bower_components/gl-form/gl-form-panel.html">
<link rel="import" href="./../../../../bower_components/gl-grid/gl-grid-col.html">
<link rel="import" href="./../../../../bower_components/gl-grid/gl-grid-row.html">
<link rel="import" href="../../components/gl-form-textarea-my-com.html">
<!-- <link rel="import" href="./../../../../bower_components/gl-form/gl-form-textarea-my-com.html"> -->
<link rel="import" href="./../../../../bower_components/gl-form/gl-form-input.html">

<link rel="import" href="./../../../../bower_components/gl-styles/gl-table.html">

<dom-module id="company-manage">
  <style is="custom-style" include="iron-flex iron-flex-factors iron-flex-alignment gl-size gl-color gl-table">
    .title {
      text-align: center;
      font-size: var(--font-size-h4);
      font-family: 'rsubold', sans-serif;
      -webkit-font-smoothing: antialiased;
      margin: 20px 0px 20px 0px;
    }

    paper-icon-button {
      margin-top: 20px;
    }

    .padding {
      padding: 20px;
    }

    table {
      border: 0.16px solid #F1F1F1;
      margin-bottom: 16px;
    }

    table.gl-table-default>tbody.table-body>tr>td {
      /*cursor: pointer;*/
      padding: 0px 15px;
    }

    .text {
      margin-top: 25px;
      font-size: var(--font-size-h5);
    }
  </style>
  <template>
    <div class="horizontal end-justified layout">
      <div hidden="{{!_checkStatus(statusAction)}}">
        <paper-icon-button icon="create" on-tap="editChange" title="{{localize.edit_data}}"></paper-icon-button>
        <paper-icon-button style="margin-right: 10px;" icon="delete" on-tap="_delete" title="{{localize.bt_delete}}"></paper-icon-button>
      </div>
    </div>

    <gl-form-panel set-border="1px" set-padding="10px 10px 10px 10px">
      <div class="title">{{localize.detail_data}}</div>

      <gl-grid-row width="{{getWidth}}">
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.tax_no}} :" value="{{data.company_taxno}}" disabled="{{_checkStatus(statusAction)}}" allowed-pattern="[0-9]"
            maxlength="13"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <paper-button hidden="{{btnEnabled}}" raised class="gl-btn-info" style="margin-right:15px;" on-tap="_search" title="{{localize.bt_search}}">
            <iron-icon icon="search"></iron-icon>{{localize.bt_search}}</paper-button>
        </gl-grid-col>
      </gl-grid-row>

      <gl-grid-row>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-textarea-my-com class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.name_company}} :" value="{{data.company_name_th}}" disabled="{{isEnabled}}"></gl-form-textarea-my-com>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-textarea-my-com class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.name_company}} ({{localize.eng}}) :" value="{{data.company_name_en}}" disabled="{{isEnabled}}"></gl-form-textarea-my-com>
        </gl-grid-col>
      </gl-grid-row>

      <gl-grid-row>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,10]]">
          <gl-form-textarea-my-com class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.address}} :" value="{{data.company_address_th}}" disabled="{{isEnabled}}"></gl-form-textarea-my-com>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,10]]">
          <gl-form-textarea-my-com class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.address}} ({{localize.eng}}) :" value="{{data.company_address_en}}" disabled="{{isEnabled}}"></gl-form-textarea-my-com>
        </gl-grid-col>
      </gl-grid-row>

      <gl-grid-row>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-textarea-my-com class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.province}} :" value="{{data.company_province_th}}" disabled="{{isEnabled}}"></gl-form-textarea-my-com>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.province}} ({{localize.eng}}) :" value="{{data.company_province_en}}" disabled="{{isEnabled}}"></gl-form-input>
        </gl-grid-col>
      </gl-grid-row>

      <gl-grid-row>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-textarea-my-com class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.tel}} :" value="{{data.company_phone}}" disabled="{{isEnabled}}"></gl-form-textarea-my-com>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.fax}} :" value="{{data.company_fax}}" disabled="{{isEnabled}}"></gl-form-input>
        </gl-grid-col>
        <gl-grid-col width="[[getWidth]]" grid="[[300,12],[500,4]]">
          <gl-form-input class="checkValidate" required error-message="{{localize.request_form}}" placeholder="{{localize.insert_form}}"
            label="{{localize.email}} :" value="{{data.company_email}}" disabled="{{isEnabled}}"></gl-form-input>
        </gl-grid-col>
      </gl-grid-row>

      <div class="horizontal layout">
        <div class="text">{{localize.list_board}}</div>
        <div hidden="[[isEnabled]]">
          <paper-icon-button icon="icons:add-circle" on-tap="_addAgent" title="{{localize.add_board}}"></paper-icon-button>
        </div>
      </div>

      <!-- <template is="dom-repeat" items="{{data.company_directors}}">
        <div class="vertical layout">
          <div class="horizontal layout">
            <gl-form-input style="width:400px;" label="{{localize.name_committee}}" auto-validate error-message="{{localize.insert_board}}"
              required value="{{item.agent_name}}" no-label-float disabled="{{isEnabled}}">
            </gl-form-input>
            <div hidden="[[isEnabled]]">
              <paper-icon-button id="[[index]]" style="margin:0px;" icon="icons:remove-circle" on-tap="_deleteAgent" title="{{localize.del_board}}"></paper-icon-button>
            </div>
          </div>
        </div>
      </template> -->
      {{localize.name_committee}}
      <table class="gl-table-default">
        <thead class="table-head">
          <tr>
            <th style="width :20%">{{localize.title_name}}</th>
            <th style="width :40%">{{localize.first_name}}</th>
            <th style="width :40%">{{localize.last_name}}</th>
          </tr>
        </thead>
        <tbody class="table-body">
          <template is="dom-repeat" items="{{data.company_directors}}">
            <tr>
              <td>
                <gl-form-input class="checkValidate" no-label-float auto-validate error-message="{{localize.insert_form}}" required value="{{item.TitleNameTH}}"
                  disabled="{{isEnabled}}">
                </gl-form-input>
              </td>
              <td>
                <gl-form-input class="checkValidate" no-label-float auto-validate error-message="{{localize.insert_form}}" required value="{{item.FirstNameTH}}"
                  disabled="{{isEnabled}}">
                </gl-form-input>
              </td>
              <td>
                <div hidden="[[isEnabled]]">
                  <paper-icon-button id="[[index]]" style="margin:0px;" icon="icons:remove-circle" on-tap="_deleteAgent" title="{{localize.del_board}}"></paper-icon-button>
                </div>
              </td>
            </tr>
          </template>
          <template is="dom-if" if="[[_isShow(data.company_directors,data.company_directors.*)]]">
            <tr>
              <td colspan="3" style="padding: 15px;text-align: center;"> [[localize.no_data]]</td>
            </tr>
          </template>
        </tbody>
      </table>
      <!--<template is="dom-repeat" items="{{data.company_directors}}">
        <div class="vertical layout">

          <div class="horizontal layout">
            <gl-form-input class="checkValidate" style="width:100px;" label="{{localize.title_name}}" auto-validate error-message="{{localize.insert_form}}"
              required value="{{item.TitleNameTH}}" disabled="{{isEnabled}}">
            </gl-form-input>
            <gl-form-input class="checkValidate" style="width:250px; margin-left:15px;" label="{{localize.first_name}}" auto-validate
              error-message="{{localize.insert_form}}" required value="{{item.FirstNameTH}}" disabled="{{isEnabled}}">
            </gl-form-input>
            <gl-form-input class="checkValidate" style="width:250px; margin-left:15px;" label="{{localize.last_name}}" auto-validate
              error-message="{{localize.insert_form}}" required value="{{item.LastNameTH}}" disabled="{{isEnabled}}">
            </gl-form-input>
            <div hidden="[[isEnabled]]">
              <paper-icon-button id="[[index]]" style="margin:0px;" icon="icons:remove-circle" on-tap="_deleteAgent" title="{{localize.del_board}}"></paper-icon-button>
            </div>
          </div>
        </div>
      </template>-->

    </gl-form-panel>

    <div class="horizontal end-justified layout">
      <div hidden="[[isEnabled]]">
        <paper-button on-tap="_cancel" raised title="{{localize.bt_back}}">{{localize.bt_back}}</paper-button>
        <paper-button class="gl-btn-success" on-tap="_save" raised title="{{localize.bt_save}}">{{localize.bt_save}}</paper-button>
      </div>
    </div>

  </template>
  <script>
    Polymer({
      is: "company-manage",
      behaviors: [ReduxBehavior, nylonBehavior, ValidateFormBehavior],
      properties: {
        data: {
          statePath: 'company.data'
        },
        isEnabled: {
          type: Boolean,
          value: false
        },
        hidButton: {
          type: Boolean,
          value: true
        },
        localize: {
          statePath: 'i18n.exporter'
        }
      },
      editChange: function () {
        this.isEnabled = false;
      },
      _addAgent: function () {
        this.push('data.company_directors', {
          TitleNameTH: '',
          FirstNameTH: '',
          LastNameTH: ''
        });
      },
      _isShow: function (data, dataLoop) {
        try {
          let resulte = data.every((item) => item.hidden === true)
          // console.log(resulte);
          return resulte
        } catch (error) {

        }
      },
      _cancel: function () {
        if (this.statusAction == 'edit') {
          this.clearData(this.data.company_taxno);
          this.resetValidate();
        } else {
          this.fire('back-page');
          this.resetValidate();
        }
      },
      _save: function () {
        if (this.statusAction == 'edit') {
          for (var key in this.data) {
            if (this.data[key] === '-') {
              this.data[key] = "";
            }
          }
          delete this.data['date_exported']
          delete this.data['company_name']
          this.fire('toast', {
            status: 'openDialog',
            text: 'คุณต้องการแก้ไขข้อมูลใช่หรือไม่ ?',
            confirmed: this._confirmSave.bind(this),
            datas: this.data
          });
        } else {
          this.fire('toast', {
            status: 'openDialog',
            text: 'คุณต้องการเพิ่มข้อมูลใช่หรือไม่ ?',
            confirmed: this._confirmSave.bind(this),
            datas: this.data
          });
        }
      },
      _confirmSave: function (result, detail) {
        if (result == true) {
          var check = this.validate();
          if (check === true) {
            if (this.statusAction == 'edit') {
              this.dispatchAction('COMPANY_UPDATE', detail.datas);
              this.resetValidate();
            } else {
              this.dispatchAction('COMPANY_INSERT', detail.datas);
              this.resetValidate();
            }
          } else {
            this.fire('toast', {
              status: 'connectError', text: 'กรุณากรอกข้อมูลให้ครบ',
              callback: function () { }
            })
          }
        }
      },
      clearData: function (val) {
        this.hidButton = false;
        this.isEnabled = true;
        this.dispatchAction('COMPANY_SEARCH', val);
        this.resetValidate();
      },
      _deleteAgent: function (e) {
        // console.log(e.currentTarget.id);
        var index = e.currentTarget.id;
        this.splice('data.company_directors', index, 1);
      },
      _checkStatus: function (val) {
        if (val == 'add') {
          this.isEnabled = false;
          this.btnEnabled = false;
          return false
        } else {
          this.isEnabled = true;
          this.btnEnabled = true;
          return true
        }
      },
      validate: function () {
        var check = this.validateForm('.checkValidate')
        return check
      },
      resetValidate: function () {
        this.queryFrom('.checkValidate').map((el) => { el.reset(); });
      },
      _delete: function () {
        this.fire('toast', {
          status: 'openDialog',
          text: 'ต้องการลบข้อมูลใช่หรือไม่ ?',
          confirmed: (result) => {
            if (result == true) {
              this.dispatchAction('COMPANY_DELETE', this.data.id);
            }
          }
        })
      },
      _search: function () {
        this.dispatchAction('COMPANY_GET_TAXNO', this.data.company_taxno);
      }
    });
  </script>
</dom-module>