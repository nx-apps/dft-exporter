<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="./components/quota-list.html">
<link rel="import" href="./components/quota-manage.html"> 
<link rel="import" href="../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../layout/shared-styles.html">

<link rel="import" href="../../nylon-behavior.html">
<link rel="import" href="../components/nylon-panel-right.html">
<link rel="import" href="../components/page-header.html">
<link rel="import" href="../components/page-panel.html">

<link rel="import" href="../../redux-behavior.html">

<dom-module id="page-quota">
  <template>
    <style include="shared-styles">
      .page{
        height: calc(100vh - 64px)
      }
    </style>
        <div class="page">
          <page-header label="จัดสรรปีโควตา">
          <template is="dom-if" if="[[checkDataSelect(selectYear)]]">
            <paper-button class="gl-btn-primary" style="margin-right:0" on-tap="addQuota" raised>
              <iron-icon icon="add"></iron-icon>
              เพิ่มโควตา
            </paper-button>
          </template>
        </page-header>
        
        
        <page-panel>
          <div class="row">
            <div class="col-xs-12 col-sm-4 col-md-2">
                ปีโควตา : 
                <vaadin-combo-box label="แสดงข้อมูลรายปี" no-label-float items="[[newYear]]" value="{{selectYear}}">
                  <template>
                    [[item.label]]
                  </template>
                </vaadin-combo-box>                
            </div>
          </div>
          <div class="row">
            <div class="col-xs-12 box-top">
                <quota-list select-year="{{selectYear}}"></quota-list>
            </div>
          </div>
          </page-panel>

        <nylon-panel-right title="กำหนดปีโควตา" width="90%">
          <quota-manage select-year="{{selectYear}}"></quota-manage> 
        </nylon-panel-right>
      </div> 
  </template> 
  <script>
    Polymer({
      is: 'page-quota',
      behaviors: [NylonBehavior,ReduxBehavior],
      listeners:{
        'open-panel':'openPanel'
      },
      observers:['getYear(selectYear)'],
      properties: {
        year: {
          statePath:'quota.year',
          observer:'setYear'
        },
        selectYear:{
          type:String,
          // statePath:'commonData.selectYear'
        },
        maxYear:Number
      },
      nylonPageActive:function(){
        // this.dispatchAction('QUOTA_SET_ELEMENT');
        this.dispatchAction('QUOTA_GET_YEAR')
        this.fire('set-nav','จัดสรรปีโควตา')
      },
      checkDataSelect:function(val){
        if(val != ''){
          // console.log(val);
          return true
        }
        else{
          return false
        } 
      },
      setYear:function(val){
        console.log(val);
        if(val.length != 0){  
          this.newYear = val
          var obj = {
            label: val[0].label + 1,
            value: val[0].value + 1
          }
          this.unshift('newYear',obj)
        }
       
        // this.unshift('newYear',{label:})
      },
      // addYear:function(val){
      //   var arr = [];
      //   arr = val;
      //   if(arr.length > 0) {
      //     var max = 0;
      //       for(var i = 0; i< arr.length; i++){
      //         if(arr[i] > max){
      //           max = arr[i];
      //         }
      //       }
      //       arr.push(max+1);
      //       // val.push(max+1)
      //      return arr.sort(function(a, b){return b-a})
      //   }
      // },
      getYear:function(year){
        if(year != ""){
          this.selectYear = year
          // console.log(year);
          this.dispatchAction('COMMON_DATA_GET_TYPE_RICE',year);
          this.dispatchAction('QUOTA_GET_QUOTA',this,year);
          // this.dispatchAction('COMMON_DATA_GET_TYPE_RICE',year);
        }
      },
      deleteData: function (e) {
        this.splice('datas', e.target.index, 1);
      },
      openPanel:function(){
        this.$$('nylon-panel-right').open();
      },
      addQuota: function () {
        this.dispatchAction('QUOTA_CLEAR')
        .then(function(){
          this.$$('nylon-panel-right').open();
        }.bind(this))
      }
    });
  </script>
</dom-module>