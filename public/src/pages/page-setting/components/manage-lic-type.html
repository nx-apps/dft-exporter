<link rel="import" href="../../../../bower_components/gl-form/gl-form-input.html">
<link rel="import" href="../../../layout/page-style.html">
<link rel="import" href="../../../layout/shared-styles.html">
<link rel="import" href="../../../../bower_components/gl-styles/gl-color.html">
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../../bower_components/gl-form/gl-form-panel.html">
<link rel="import" href="../../../../bower_components/gl-form/gl-form-textarea.html">
<link rel="import" href="../../components/validateFormBehaviors.html">
<link rel="import" href="../../../redux-behavior.html">
<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html">
<dom-module id="manage-lic-type">
    <template>
        <style include="page-style shared-styles gl-color">
            * {
                font-family: 'CSChatThaiUI', sans-serif;
                -webkit-font-smoothing: antialiased;
            }

            .header-manage {
                margin-top: 20px;
                margin-bottom: 10px;
            }
        </style>
        <gl-form-panel set-padding="10px 20px 10px 20px" set-border="1px">


            <template is="dom-if" if={{!btnSetting.typeIsInsert}}>
                <gl-form-panel-head label="" set-padding="10px" set-border="1px">
                    <div class="horizontal end-justified layout">
                        <paper-icon-button class="crud" data="{{item}}" on-tap="editStatus" icon="create" disabled="{{!btnSetting.status}}"></paper-icon-button>
                        <paper-icon-button class="crud" data="{{item}}" on-tap="deleteDocType" icon="delete" disabled="{{!btnSetting.status}}"></paper-icon-button>
                    </div>
                </gl-form-panel-head>
            </template>
            <div class="horizontal center-justified layout">
                <div class="flex">
                </div>
                <div class="flex-2 flex-padding" style="text-align: center">
                    <div class="header-manage">
                        ประเภทผู้ส่งออก
                    </div>
                </div>
                <div class="flex">
                </div>
            </div>
            <div class="horizontal center-justified layout">
                <div class="flex">
                </div>
                <div class="flex-2 flex-padding">
                    <gl-form-input class="required" required always-float-label label="Code :" value="{{data.id}}" disabled="{{!btnSetting.typeIsInsert}}"></gl-form-input>
                </div>
                <div class="flex">
                </div>
            </div>
            <div class="horizontal center-justified layout">
                <div class="flex">
                </div>
                <div class="flex-2 flex-padding">
                    <gl-form-input class="required" required always-float-label label="ชื่อประเภท :" value="{{data.lic_type_name}}" disabled="{{btnSetting.status}}"></gl-form-input>
                </div>
                <div class="flex">
                </div>
            </div>
            <div class="horizontal center-justified layout">
                <div class="flex">
                </div>
                <div class="flex-2 flex-padding">
                    <gl-form-input class="required" required always-float-label label="คำนำหน้าประเภท :" value="{{data.lic_type_prefix}}" disabled="{{btnSetting.status}}"></gl-form-input>
                </div>
                <div class="flex">
                </div>
            </div>
            <div class="horizontal center-justified layout">
                <div class="flex">
                </div>
                <div class="flex-2 flex-padding">
                    <gl-form-textarea class="required" required row="2" always-float-label label="ความหมาย :" value="{{data.lic_type_fullname}}"
                        disabled="{{btnSetting.status}}"></gl-form-textarea>
                </div>
                <div class="flex">
                </div>
            </div>
            <gl-form-panel-footer label="" set-padding="10px">
                <div class="horizontal end-justified layout">
                    <template is="dom-if" if={{!btnSetting.typeIsInsert}}>
                        <div>
                            <paper-button class="button-top gl-btn-default" raised on-tap="cancelDocType" hidden="{{btnSetting.status}}">
                                <iron-icon icon="cached"></iron-icon>&nbsp;&nbsp;คืนค่า</paper-button>
                        </div>
                        <div>
                            <paper-button class="button-top gl-btn-success" raised on-tap="saveDocType" hidden="{{btnSetting.status}}">
                                <iron-icon icon="save"></iron-icon>&nbsp;&nbsp;บันทึก</paper-button>
                        </div>
                    </template>
                    <template is="dom-if" if={{btnSetting.typeIsInsert}}>
                        <div>
                            <paper-button class="button-top gl-btn-primary" raised on-tap="addDocType">
                                <iron-icon icon="add"></iron-icon>&nbsp;&nbsp; เพิ่ม</paper-button>
                        </div>
                    </template>
                </div>
            </gl-form-panel-footer>
        </gl-form-panel>
    </template>
    <script>
        Polymer({
            is: 'manage-lic-type',
            behaviors: [ReduxBehavior, ValidateFormBehavior],
            properties: {
                data: {
                    statePath: 'setting.lictype'
                },
                btnSetting: {
                    statePath: 'setting.btn'
                }
            },
            editStatus() {
                this.dispatchAction('SETTING_BTN', {
                    typeIsInsert: false,
                    btnShow: true,
                    status: false
                })
            },
            cancelDocType() {
                this.fire('toast', {
                    status: 'openDialog',
                    text: 'คุณต้องการจะยกเลิกการแก้ไข ใช่หรือไม่ ?',
                    confirmed: (result) => {
                        if (result == true) {
                            this.queryFrom('.required').map(el => el.reset())
                            this.dispatchAction('SETTING_GET_ID_LIC', this.data.id)
                            this.dispatchAction('SETTING_BTN', {
                                typeIsInsert: false,
                                btnShow: true,
                                status: true
                            })
                        }
                    }
                })

            },
            saveDocType() {
                if (this.validateForm('.required')) {
                    this.fire('toast', {
                        status: 'openDialog',
                        text: 'คุณต้องการจะแก้ไข ใช่หรือไม่ ?',
                        confirmed: (result) => {
                            if (result == true) {
                                this.queryFrom('.required').map(el => el.reset())
                                this.fire('toast', { status: 'load' });
                                this.dispatchAction('SETTING_PUT_LIC', this.data)
                                    .then((res) => {
                                        this.fire('toast', {
                                            status: 'success', text: 'แก้ไขข้อมูลสำเร็จ', callback: () => {
                                                this.dispatchAction('SETTING_GET_LIST_LIC')

                                                this.fire('closePanel')
                                            }
                                        });

                                    })
                                    .catch((error) => {
                                        this.fire('toast', { status: 'connectError', text: 'ไม่สามารถแก้ไขได้', callback: () => { } })
                                    })
                            }
                        }
                    })
                } else {
                    this.fire('toast', { status: 'connectError', text: 'กรุณากรอกข้อมูลใหครบทุกช่อง', callback: () => { } })
                }
            },
            addDocType() {
                this.fire('toast', { status: 'load' });
                this.dispatchAction('SETTING_POST_LIC', this.data)
                    .then((res) => {
                        this.queryFrom('.required').map(el => el.reset())
                        this.fire('toast', {
                            status: 'success', text: 'เพิ่มข้อมูลสำเร็จ', callback: () => {
                                this.dispatchAction('SETTING_GET_LIST_LIC')
                                this.fire('closePanel')
                            }
                        })
                    })
                    .catch((error) => {
                        this.fire('toast', { status: 'connectError', text: 'ไม่สามารถเพิ่มได้', callback: () => { } })
                    })
            },
            deleteDocType(e) {
                this.fire('toast', {
                    status: 'openDialog',
                    text: 'คุณต้องการจะลบ ใช่หรือไม่ ?',
                    confirmed: (result) => {
                        if (result == true) {
                            this.queryFrom('.required').map(el => el.reset())
                            // this.fire('toast', { status: 'connectError', text: 'ไม่สามารถลบได้', callback: () => { } })
                            this.dispatchAction('SETTING_DELETE_LIC', this.data.id)
                                .then((res) => {
                                    this.fire('toast', {
                                        status: 'success', text: 'ลบข้อมูลสำเร็จ', callback: () => {
                                            this.dispatchAction('SETTING_GET_LIST_LIC')
                                            this.fire('closePanel')
                                        }
                                    })
                                }).catch((error) => {
                                    this.fire('toast', { status: 'connectError', text: 'ไม่สามารถลบได้', callback: () => { } })
                                })
                        }
                    }
                })

            }
        });
    </script>
</dom-module>