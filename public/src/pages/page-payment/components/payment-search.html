<link rel="import" href="../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../layout/shared-styles.html">
<link rel="import" href="../../../redux-behavior.html">
<dom-module id="payment-search">
    <template>
        <style include="shared-styles">
        </style>
        <page-panel>
            <div class="row around-xs">
                <div class="col-xs-4">
                    <div class="box">
                        <vaadin-combo-box label="ปี" items="[[year]]" value="{{search.year}}" error-message="กรุณาเลือกปี">
                            <template>
                                [[item.label]]
                            </template>
                        </vaadin-combo-box>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="box">
                        {{searchInput(exproterSeach)}}
                        <vaadin-combo-box label="ชื่อบริษัท" items="[[exporter]]" item-label-path="company_name_th" loading="{{check}}" item-value-path="company_taxno"
                            filter="{{exproterSeach}}" value="{{search.exporter_id}}">
                            <template>
                                [[item.company_name_th]]
                            </template>
                        </vaadin-combo-box>
                    </div>
                </div>
            </div>
            <div class="row around-xs">
                <div class="col-xs-4">
                    <div class="box">
                        <vaadin-date-picker label="เริ่มวันที่" value="{{search.from_date}}"></vaadin-date-picker>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="box">
                        <vaadin-date-picker label="ถึงวันที่" value="{{search.to_date}}"></vaadin-date-picker>
                    </div>
                </div>
            </div>
            <div class="row center-xs">
                <div class="col-xs-6">
                    <div class="box">
                        <paper-button style="width:100%" class="gl-btn-primary" on-tap="searchData" raised>ค้นหา</paper-button>
                    </div>
                </div>
            </div>
        </page-panel>
    </template>
    <script>
        Polymer({
            is: 'payment-search',
            behaviors: [ReduxBehavior],
            properties:{
                year:{
                    statePath: 'commonData.year',
                },
                exporter: {
                    statePath: 'commonData.companyReport',
                    observer: 'checkItem'
                },
                check:{
                    type:Boolean,
                    value:true
                },
                search:{
                    type:Object,
                    value:{
                        year:'2017',
                        exporter_id:'0105522018355',
                        from_date:'2017-09-19',
                        to_date:'2017-09-20'
                    }
                }
            },
            checkItem:function(){
                this.check = false;
            },
            searchData: function () {
                // console.log(this.search)
                this.fire('toast', { status: 'load' });
                this.dispatchAction('PAYMENT_GET_SEARCH_LIST', this.search)
                .then(function () {
                    this.fire('toast', {
                        status: 'success', text: 'โหลดข้อมูลสำเร็จ',
                        callback: function () {
                        }
                    });
                }.bind(this))
                .catch(function (error) {
                    console.log({error})
                    this.fire('toast', {
                        status: 'connectError', text: error,
                        callback: function () {
                        }
                    })
                }.bind(this))
            },
            searchInput: function (value) {
                this.check = true;
                this.debounce('searchItem', () => {
                    // 
                    if (typeof value != 'undefined' && value.length >= 3) {
                        this.dispatchAction('COMMON_DATA_GET_COMPANY_REPORT', value);
                    }
                    else {
                        console.log('clear')
                        this.dispatchAction('COMMON_DATA_GET_COMPANY_CLEAR');
                    }

                }, 1000)
            }
            
        });
    </script>
</dom-module>