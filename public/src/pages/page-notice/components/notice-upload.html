<link rel="import" href="./../../../../bower_components/polymer/polymer.html">
<link rel="import" href="./../../../../bower_components/vaadin-grid/vaadin-grid.html">
<link rel="import" href="./../../../layout/shared-styles.html">
<link rel="import" href="./../../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../redux-behavior.html">
<dom-module id="notice-upload">
    <template>
        <style include="shared-styles">
            paper-button{
                width:100%;
            }
        </style>    

        <paper-button on-tap="clickUpload" raised><iron-icon icon="get-app"></iron-icon>UPLOAD</paper-button>
        <input id="upload" type="file" on-change="changeFile" id="file" hidden multiple accept="application/pdf">
        <div class="white-space"></div>
        <vaadin-grid slot="grid" id="material" items="[[fileList]]" size="200">
            <vaadin-grid-column width="60px" flex-grow="0">
                <template class="header">
                    <div style="text-align:center">
                       #
                    </div>
                </template>
                <template>
                    <div style="text-align:center">
                        [[count(index)]]
                    </div>   
                </template>
            </vaadin-grid-column>
            <vaadin-grid-column width="500px">
                <template class="header">
                    <div>
                       ชื่อไฟล์
                    </div>
                </template>
                <template>
                    <div>
                        [[item.name]]
                    </div>   
                </template>
             </vaadin-grid-column>
            <vaadin-grid-column width="200px">
                <template class="header">
                    <div>
                       วันที่อัพโหลด
                    </div>
                </template>
                <template>
                    <div>
                        [[item.timestamp]]
                    </div>   
                </template>
            </vaadin-grid-column>
            <vaadin-grid-column width="20px">
                <template class="header">
                    <div>
                       จัดการ
                    </div>
                </template>
                <template>
                    <div>
                       <paper-icon-button on-tap="getFile" icon="get-app"></paper-icon-button>
                       <paper-icon-button on-tap="deleteFile" icon="delete"></paper-icon-button>
                    </div>   
                </template>
             </vaadin-grid-column>
        </vaadin-grid>
    </template>
    <script>
        Polymer({
            is: 'notice-upload',
            behaviors: [ReduxBehavior],
            properties:{
                fileList:{
                    statePath:'notice.fileList'
                }
            },
            count:function(val){
                return val+1;
            },
            clickUpload:function(){
                this.$.upload.click();
            },
            changeFile:function(e){
                // console.log(e.currentTarget.files)
                this.fire('toast',{status:'load'});
                this.dispatchAction('NOTICE_UPLOAD', e.currentTarget.files)
                .then(function (res) {
                    this.fire('toast',{status:'success',text:'บันทึกสำเร็จ',
                        callback:()=>{
                            this.dispatchAction('NOTICE_GET_FILE_LIST');
                        }
                    });
                    // this.$.toast.close();
                }.bind(this))
            },
            getFile:function(e){
                console.log(e.model.item.file_id)
                window.open('/api/fileNotify/showFile?id='+e.model.item.file_id,'_blank');
            },
            deleteFile:function(e){
                this.fire('toast',{ 
                 status:'openDialog',
                 text:'ต้องการลบข้อมูลใช่หรือไม่ ?',
                 confirmed:this._deleteData.bind(this),  
                 id:e.model.item.file_id 
                 })
            },
            _deleteData:function(check,val){
                console.log(check,val.id)
                this.dispatchAction('NOTICE_DELETE_FILE',val.id)
            }
        });
    </script>
</dom-module>
