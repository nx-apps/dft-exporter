<link rel="import" href="../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../layout/shared-styles.html">
<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../nylon-behavior.html">
<link rel="import" href="../components/nylon-panel-right.html">
<link rel="import" href="../components/page-header.html">
<link rel="import" href="../components/page-panel.html">
<link rel="import" href="./components/status-list.html">
<link rel="import" href="../../redux-behavior.html">
<link rel="import" href="./components/status-exporter.html">


<!--<link rel="import" href="./../../layout/flexbox-grid.html">-->

<dom-module id="page-status">
	<template>
		<style include="shared-styles"></style>

		<page-header label="[[i18n.status.statusReport]]">
			<!--<div style="text-align:left;">-->
			<!--<vaadin-combo-box items="[[year]]" value="{{selectYear}}"></vaadin-combo-box>-->
			<!--</div>-->
			<!--<vaadin-combo-box style="text-align:left; width:50%" items="[[typeRice]]" item-label-path="type_rice_name_th" item-value-path="type_rice_id" value="{{selectTypeRice}}"></vaadin-combo-box> 			-->
		</page-header>

		<page-panel>
			<div class="row around-xs">
				<div class="col-xs-4">
					<div class="box">
						<vaadin-combo-box label="ปีโควตา" items="[[year]]" value="{{selectYear}}"></vaadin-combo-box>
						<!--<vaadin-combo-box label="แสดงข้อมูลรายปี" items="[[year]]" value="{{selectYear}}"></vaadin-combo-box>-->
					</div>
				</div>
				<div class="col-xs-4">
					<div class="box">
						<vaadin-combo-box label="ประเภทข้าว" items="[[typeRice]]" item-label-path="type_rice_name_th" item-value-path="type_rice_id" value="{{selectTypeRice}}">
							<template>
								[[item.type_rice_name_th]]
							</template>
						</vaadin-combo-box>
						<!--<vaadin-combo-box label="ประเภทข้าว" items="[[typeRice]]" item-label-path="type_rice_name_th" item-value-path="id" value="{{selectTypeRice}}"></vaadin-combo-box>-->
					</div>
				</div>
			</div>
		</page-panel>
		<div class="white-space"></div>
		<page-panel>
			<status-list select-exporter="[[selectExporter]]" on-open-panel="addExporter" data-select="{{dataSelect}}"></status-list>
		</page-panel>
		<nylon-panel-right title="เพิ่มบริษัท">
			<status-exporter on-get-exporter="getExporter"></status-exporter>
		</nylon-panel-right>
		
	</template>
	<script>
		Polymer({
			is: 'page-status',
			behaviors: [NylonBehavior, ReduxBehavior],
			observers: ['setYear(selectYear)', 'getData(selectYear,selectTypeRice)'],
			properties: {
				year: {
					statePath: 'commonData.year'
				},
				typeRice: {
					statePath: 'commonData.type_rice'
				},
				dataSelect: {
					type: Object,
					value: {}
				}
			},
			addExporter: function () {
				this.$$('nylon-panel-right').open();
			},
			getExporter: function (e) {
				this.fire('toast', {
					status: 'success', text: 'บันทึกสำเร็จ',
					callback: function () {
						this.selectExporter = e.detail;
						this.$$('nylon-panel-right').close();
					}.bind(this)
				});
			},
			nylonPageActive: function () {
				this.dispatchAction('COMMON_DATA_GET_YEAR');
				// this.dispatchAction('COMMON_DATA_GET_TYPE_RICE');
				this.dispatchAction('COMMON_DATA_GET_COMPANY');
			},
			setYear: function (val) {
				if (val != ''){
					this.dispatchAction('COMMON_DATA_SET_YEAR', val);
				}
			},
			getData: function (year, type_rice) {
				if (year != '' && type_rice != '') {
					// console.log('test')
					this.dataSelect.year = year;
					this.dataSelect.type_rice = type_rice;
					this.dispatchAction('STATUS_CLEAR_DATA')
					.then(()=>{
						this.dispatchAction('STATUS_GET_DATA', year, type_rice);
					})
					
					this.data = this.dataList;
				}
			}
		});
	</script>
</dom-module>