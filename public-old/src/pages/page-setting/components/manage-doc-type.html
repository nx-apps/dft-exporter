<link rel="import" href="../../../../bower_components/gl-form/gl-form-input.html">
<link rel="import" href="../../../layout/page-style.html">
<link rel="import" href="../../../layout/shared-styles.html">
<link rel="import" href="../../../../bower_components/gl-styles/gl-color.html">
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../../bower_components/gl-form/gl-form-panel.html">
<link rel="import" href="../../components/validateFormBehaviors.html">
<link rel="import" href="../../../redux-behavior.html">
<link rel="import" href="../../../../bower_components/iron-icon/iron-icon.html">
<dom-module id="manage-doc-type">
    <template>
        <style include="page-style shared-styles gl-color">
             :host {
                display: block;
            }

            .header-manage {
                margin-top: 20px;
                margin-bottom: 10px;
            }
        </style>
        <gl-form-panel set-padding="10px 20px 10px 20px" set-border="1px">


            <template is="dom-if" if={{!btnSetting.typeIsInsert}}>
                <gl-form-panel-head label="" set-padding="10px" set-border="1px">
                    <div class="horizontal end-justified layout">
                        <paper-icon-button class="crud" data="{{item}}" on-tap="editStatus" icon="create" disabled="{{!btnSetting.status}}"></paper-icon-button>
                        <paper-icon-button class="crud" data="{{item}}" on-tap="deleteDocType" icon="delete" disabled="{{!btnSetting.status}}"></paper-icon-button>
                    </div>
                </gl-form-panel-head>
            </template>
            <div class="horizontal center-justified layout">
                <div class="flex">
                </div>
                <div class="flex-2 flex-padding" style="text-align: center">
                    <div class="header-manage">
                        {{localize.doc_type}}
                    </div>
                </div>
                <div class="flex">
                </div>
            </div>
            <div class="horizontal center-justified layout">
                <div class="flex">
                </div>
                <div class="flex-2 flex-padding">
                    <gl-form-input class="required" required always-float-label label=" {{localize.type_name}} :" value="{{data.doc_type_th}}" disabled="{{btnSetting.status}}"></gl-form-input>
                </div>
                <div class="flex">
                </div>
            </div>
            <gl-form-panel-footer label="" set-padding="10px">
                <div class="horizontal end-justified layout">
                    <template is="dom-if" if={{!btnSetting.typeIsInsert}}>
                        <div>
                            <paper-button class="button-top gl-btn-default" raised on-tap="cancelDocType" hidden="{{btnSetting.status}}">
                                <iron-icon icon="cached"></iron-icon>&nbsp;&nbsp;{{localize.restore_data}} </paper-button>
                        </div>
                        <div>
                            <paper-button class="button-top gl-btn-success" raised on-tap="saveDocType" hidden="{{btnSetting.status}}">
                                <iron-icon icon="save"></iron-icon>&nbsp;&nbsp;{{localize.save_data}} </paper-button>
                        </div>
                    </template>
                    <template is="dom-if" if={{btnSetting.typeIsInsert}}>
                        <div>
                            <paper-button class="button-top gl-btn-primary" raised on-tap="addDocType">
                                <iron-icon icon="add"></iron-icon>&nbsp;&nbsp; {{localize.add}}</paper-button>
                        </div>
                    </template>
                </div>
            </gl-form-panel-footer>
        </gl-form-panel>
    </template>
    <script>
        Polymer({
            is: 'manage-doc-type',
            behaviors: [ReduxBehavior, ValidateFormBehavior],
            properties: {
                data: {
                    statePath: 'setting.doctype'
                },
                btnSetting: {
                    statePath: 'setting.btn'
                },
                localize: {
                    statePath: 'i18n.setting'
                },
            },
            editStatus() {
                this.dispatchAction('SETTING_BTN', {
                    typeIsInsert: false,
                    btnShow: true,
                    status: false
                })
            },
            cancelDocType() {
                this.fire('toast', {
                    status: 'openDialog',
                    text: this.localize.cancel_edit,
                    confirmed: (result) => {
                        if (result == true) {
                            this.queryFrom('.required').map(el => el.reset())
                            this.dispatchAction('SETTING_GET_ID_DOC', this.data.id)
                            this.dispatchAction('SETTING_BTN', {
                                typeIsInsert: false,
                                btnShow: true,
                                status: true
                            })
                        }
                    }
                })

            },
            saveDocType() {
                if (this.validateForm('.required')) {
                    this.fire('toast', {
                        status: 'openDialog',
                        text: this.localize.want_edit,
                        confirmed: (result) => {
                            if (result == true) {
                                this.queryFrom('.required').map(el => el.reset())
                                this.fire('toast', { status: 'load' });
                                this.dispatchAction('SETTING_PUT_DOC', this.data)
                                    .then((res) => {
                                        this.fire('toast', {
                                            status: 'success', text: this.localize.edit_success, callback: () => {
                                                this.dispatchAction('SETTING_GET_LIST_DOC')

                                                this.fire('closePanel')
                                            }
                                        });

                                    })
                                    .catch((error) => {
                                        this.fire('toast', { status: 'connectError', text: this.localize.cannot_edit, callback: () => { } })
                                    })
                            }
                        }
                    })
                } else {
                    this.fire('toast', { status: 'connectError', text: this.localize.please_full_fied, callback: () => { } })
                }
            },
            addDocType() {
                this.fire('toast', { status: 'load' });
                this.dispatchAction('SETTING_POST_DOC', this.data)
                    .then((res) => {
                        this.queryFrom('.required').map(el => el.reset())
                        this.fire('toast', {
                            status: 'success', text: this.localize.add_sucess, callback: () => {
                                this.dispatchAction('SETTING_GET_LIST_DOC')
                                this.fire('closePanel')
                            }
                        })
                    })
                    .catch((error) => {
                        this.fire('toast', { status: 'connectError', text: this.localize.can_not_add, callback: () => { } })
                    })
            },
            deleteDocType(e) {
                this.fire('toast', {
                    status: 'openDialog',
                    text: this.localize.want_delete,
                    confirmed: (result) => {
                        if (result == true) {
                            this.queryFrom('.required').map(el => el.reset())
                            this.fire('toast', { status: 'connectError', text: this.localize.cannot_delete, callback: () => { } })
                            // this.dispatchAction('SETTING_DELETE_DOC', this.data.id)
                            //     .then((res) => {
                            //         this.fire('toast', {
                            //             status: 'success', text: this.localize.delete_success, callback: () => {
                            //                 this.dispatchAction('SETTING_GET_LIST_DOC')
                            //                 this.fire('closePanel')
                            //             }
                            //         })
                            //     }).catch((error) => {
                            //         this.fire('toast', { status: 'connectError', text: this.localize.cannot_delete, callback: () => { } })
                            //     })
                        }
                    }
                })

            }
        });
    </script>
</dom-module>