<link rel="import" href="../components/dataBehavior.html">
<link rel="import" href="components/detail-company.html">
<link rel="import" href="components/fileup-company.html">
<link rel="import" href="./../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../nylon-behavior.html">
<link rel="import" href="./../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="./../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="./../../../bower_components/gl-styles/gl-size.html">
<link rel="import" href="./../../../bower_components/gl-styles/gl-color.html">
<link rel="import" href="./../../../bower_components/gl-styles/gl-toast.html">
<link rel="import" href="./../../layout/nylon-toast.html">
<link rel="import" href="./../../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="./../../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="./../../../bower_components/gl-form/gl-form-panel.html">
<link rel="import" href="./../../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="../../action/exporterAction.html">

<link rel="import" href="../../redux-behavior.html">

<link rel="import" href="../../nylon-behavior.html">

<link rel="import" href="../../action/confirmAction.html">

<dom-module id="page-company">
  <style is="custom-style" include="iron-flex iron-flex-factors iron-flex-alignment gl-size gl-color gl-toast">
    * {
      font-family: 'CSChatThaiUI', sans-serif !important;
      -webkit-font-smoothing: antialiased;
    }
    .title {
      text-align: center;
      font-size: var(--font-size-h4);
      font-family: 'rsubold', sans-serif;
      -webkit-font-smoothing: antialiased;
      margin: 20px 0px 20px 0px;
    }
    .searchBox {
      padding: 5px;
      background-color: var(--gl-gray-lighter-color);
    }
    .searchBorder {
      border: 1px solid var(--gl-gray-light-color);
      margin: 15px;
      border-radius: 3px
    }
    paper-tabs {
      background-color: #f7941e;
      margin: 15px;
      color: #F2F2F2;
      --paper-tabs-selection-bar: {
        height: 5px;
        background-color: var(--gl-info-color);
      }
    }
    paper-tab:focus>div.tab-content {
      background-color: yellow;
      opacity: 1;
      font-weight: 0;
    }
    paper-tab:not(:last-of-type) {
      border-right: 3px solid var(--gl-gray-light-color);
      font-size: var(--font-size-h5);
    }
    paper-tabs paper-tab.iron-selected {
      font-size: var(--font-size-h5);
      color: var(--gl-white-color);
      background-color: var(--gl-info-color);
    }
  </style>
  <template>
    [[checkStatus(data.approve_status)]]
    
    <div class="horizontal end-justified layout" style="margin:10px">
      <paper-button id="btn-register" raised class="gl-btn-primary" on-tap="_register" hidden>
        <iron-icon icon="add"></iron-icon>{{localize.bt_register}}</paper-button>
      <paper-button id="btn-reject" raised class="gl-btn-primary" on-tap="_reject" hidden>
        <iron-icon icon="add"></iron-icon>{{localize.bt_sent_new}}</paper-button>
    </div>

    <div>
      <paper-tabs selected="{{pages}}" align-bottom no-slide>
        <paper-tab>{{localize.detail}}</paper-tab>
        <paper-tab id="tabFile">{{localize.doc_ev}}</paper-tab>
      </paper-tabs>
      <gl-form-panel>
        <iron-pages selected="{{pages}}">
          <detail-company></detail-company>
          <fileup-company></fileup-company>
        </iron-pages>
      </gl-form-panel>
    </div>
  </template>
  <script>
    Polymer({
      is: "page-company",
      behaviors: [ReduxBehavior, nylonBehavior, confirmAction, exporterAction],
      properties: {
        pages: {
          type: Number,
          notify: true,
          value: 0
        },
        data: {
          statePath : 'confirm.data'
        },
        localize:{
          statePath : 'i18n.exporter'
        }
      },
      listeners: {
        'refresh-exporterTrader': 'getExporterTrader'
      },
      nylonPageActive: function () {
        this.id = window.location.pathname.split('/')[2];
        this.dispatchAction('EXPORTER_GET_DOC_TYPE');
        this.dispatchAction('CONFIRM_SEARCH', this.id);
        this.dispatchAction('EXPORTER_GET_TYPE_LIC');
      },
      checkStatus: function (val) {
        if (typeof val != 'undefined' && val != undefined) {
          if (val == 'reject') {
            this.$$('#btn-reject').removeAttribute("hidden");
            this.$$('#btn-register').setAttribute("hidden", "hidden");
          }
          else if(val == 'request'){
            this.$$('#btn-register').setAttribute("hidden", "hidden");
            this.$$('#btn-reject').setAttribute("hidden", "hidden");
          }
          else if(val == 'register'){
            this.$$('#btn-register').removeAttribute("hidden");
            this.$$('#btn-reject').setAttribute("hidden", "hidden");
          }
        }
      },
      _register: function () {
        var data = {
          approve_status: 'request',
          company_id: this.data.id,
          company_taxno: this.data.company_taxno,
          type_lic_id: this.data.type_lic_id
        }
        this.fire('toast', {
          status: 'openDialog',
          text: 'คุณต้องการจะสมัครผู้ส่งออกใช่หรือไม่ ?',
          confirmed: (result) => {
            if(result == true){
              var check = this.$$('detail-company').validate();
              if (check == true) {
                this.dispatchAction('CONFIRM_REGISTER',data);
                this.$$('#btn-register').setAttribute("hidden", "hidden");
              } else {
                this.fire('toast', { status: 'connectError', text: 'กรุณากรอกข้อมูลให้ครบ' })
              }
            }
          }
        });
      },
      _reject: function () {
        var data = {
          approve_status: 'request',
          id: this.data.id,
          company_taxno: this.data.company_taxno
        }
        this.fire('toast', {
          status: 'openDialog',
          text: 'คุณต้องการจะส่งเอกสารใหม่ใช่หรือไม่ ?',
          confirmed: (result) => {
            if (result == true) {
              this.dispatchAction('CONFIRM_COMPANY_REJECT', data)
              this.$$('#btn-reject').setAttribute("hidden", "hidden");
            }
          }
        });
      }
    });
  </script>
</dom-module>