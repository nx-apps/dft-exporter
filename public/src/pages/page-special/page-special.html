<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../layout/shared-styles.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../redux-behavior.html">
<link rel="import" href="../../nylon-behavior.html">
<link rel="import" href="../components/format-number-behavior.html">
<link rel="import" href="../components/page-header.html">
<link rel="import" href="../components/page-panel.html">
<link rel="import" href="../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="./components/special-list.html">
<link rel="import" href="./components/special-manage.html">
<link rel="import" href="../components/nylon-panel-right.html">

<dom-module id="page-special">
    <template>
        <style include="shared-styles">
            paper-button {
                margin: 0;
            }

            .textRight {
                text-align: right;
            }

            .page {
                height: calc(100vh - 64px);
            }
        </style>

        <div class="page">
            <page-header label="งวดพิเศษ"></page-header>
            <page-panel>
                <div class="row">
                    <div class="col-xs-12">
                        <div class="row between-xs">
                            <div class="col-xs-8">
                                <div class="row">
                                    <div class="col-xs-4">
                                        <vaadin-combo-box label="ปีโควตา" items="[[year]]" value="{{data.year}}"></vaadin-combo-box>
                                    </div>
                                    <div class="col-xs-4">
                                        <vaadin-combo-box label="ประเภทข้าว" items="[[typeRice]]" value="{{data.type_rice_id}}"></vaadin-combo-box>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-4 textRight">
                                <!-- <paper-button class="gl-btn-primary" disabled="[[active]]" on-tap="sendEdi" raised>ส่ง EDI</paper-button> -->
                                <paper-button class="gl-btn-primary" disabled="[[active]]" on-tap="openPanel">เพิ่มงวดพิเศษ</paper-button>
                            </div>
                        </div>
                    </div>
                    <div class="col-xs-12">
                        <special-list></special-list>
                    </div>
                </div>
            </page-panel>
        </div>
        <nylon-panel-right id="right" title="จัดการ" width="90%">
            <special-manage></special-manage>
        </nylon-panel-right>
    </template>
    <script>
        Polymer({
            is: "page-special",
            behaviors: [NylonBehavior, ReduxBehavior, FormatNumberBehavior],
            observers: ['setYear(data.year)', 'searchData(data.year,data.type_rice_id)'],
            listeners: {
                'open-panel': 'openPanel',
                'close-panel': 'closePanel'
            },
            properties: {
                data: {
                    type: Object,
                    value: {}
                },
                year: {
                    type: Array,
                    statePath: 'commonData.year'
                },
                typeRice: {
                    type: Array,
                    statePath: 'commonData.type_rice'
                },
                active: {
                    type: Boolean,
                    statePath: 'special.active'
                }
            },
            nylonPageActive: function () {
                this.dispatchAction('COMMON_DATA_GET_YEAR')
            },
            setYear: function (val) {
                if (val)
                    this.dispatchAction('COMMON_DATA_SET_YEAR', val)
            },
            searchData: function (year, type_rice_id) {
                if (year && type_rice_id) {
                    this.dispatchAction('SPECIAL_SET_DATA', { year, type_rice_id });
                    this.dispatchAction('SPECIAL_GET_DATA');
                }
            },
            sendEdi: function () {
                this.dispatchAction('SPECIAL_SEND_EDI', this.data)
            },
            openPanel: function () {
                this.dispatchAction('SPECIAL_CLEAR')
                this.$.right.open()
            },
            closePanel: function () {
                this.$.right.close()
            }
        });
    </script>
</dom-module>