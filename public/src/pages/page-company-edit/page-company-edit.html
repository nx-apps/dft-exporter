<link rel="import" href="components/company-manage.html">
<link rel="import" href="./../components/panel-right/panel-right.html">
<link rel="import" href="./../../nylon-behavior.html">
<link rel="import" href="./../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="./../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="./../../../bower_components/gl-form/gl-combo-box.html">
<link rel="import" href="./../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="./../../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="./../../../bower_components/gl-styles/gl-size.html">
<link rel="import" href="./../../../bower_components/gl-styles/gl-color.html">
<link rel="import" href="./../../../bower_components/gl-styles/gl-toast.html">
<link rel="import" href="./../../../bower_components/gl-styles/gl-table.html">

<dom-module id="page-company-edit">
  <style is="custom-style" include="iron-flex iron-flex-factors iron-flex-alignment gl-size gl-color gl-table gl-toast">
    * {
      font-family: 'CSChatThaiUI', sans-serif !important;
      -webkit-font-smoothing: antialiased;
    }
    .head-title{
      text-align: center;
      font-size: var(--font-size-h3);
      margin-top:15px;
    }
    .title {
      text-align: center;
      font-size: var(--font-size-h3);
    }
    .text-table {
      text-align: center;
      font-size: var(--font-size-h5);
    }
    .searchBox {
      padding: 5px;
      background-color: var(--gl-gray-lighter-color);
    }
    .elevation {
      border-radius: 5px;
      margin: 10px;
      padding: 5px;
    }
    .searchBorder {
      border: 1px solid var(--gl-gray-light-color);
      margin: 15px;
      border-radius: 3px;
    }
    .gl-table-default {
      border-collapse: collapse;
      width: 100%;
      white-space: nowrap;
    }
    paper-material {
      background-color: var(--gl-white-color);
    }
    table.gl-table-default>thead.table-head>tr>th:nth-child(1) {
      width: 5%;
    }
    table.gl-table-default>thead.table-head>tr>th:nth-child(2) {
      width: 10%;
    }
  </style>
  <template>

    <paper-material elevation="1" class="elevation">

      <div class="layout horizontal justified">
        <div></div>
        <div class="head-title">{{localize.list_name_company}}</div>
        <div>
          <paper-button raised class="gl-btn-primary" style="margin-right:15px;" on-tap="_add" title="{{localize.bt_add_company}}">
          <iron-icon icon="add"></iron-icon>{{localize.bt_add_company}}</paper-button>
        </div>
      </div>

      <div class="horizontal center-justified layout">
        <gl-combo-box label="{{localize.tax_no}}" placeholder="{{localize.insert_taxno}}" items="{{list_search}}" 
        item-label-path="company_name" item-value-path="company_taxno"
        on-value-changed="_checkID" style="width:600px; margin-top:10px;">
        <template>[[item.company_name]]</template>
        </gl-combo-box>
      </div>

      <div class="searchBorder" style="height:600px; overflow-x:auto; overflow-y:auto;">
          <table class="gl-table-default">
            <thead class="table-head">
              <tr>
                <th><div class="text-table">#</div></th>
                <th><div>{{localize.tax_no}}</div></th>
                <th><div>{{localize.name_company}}</div></th>
                <th><div>{{localize.province}}</div></th>
              </tr>
            </thead>
            
            <template is="dom-repeat" items="{{company}}">
              <tbody>
                <tr id="detailRegExporter" on-tap="_selectData" data="[[item]]" style="cursor:pointer;">
                  <td><div class="text-table">[[toIndex(index)]]</div></td>
                  <td><div>{{item.company_taxno}}</div></td>
                  <td><div style="width:300px;">{{item.company_name_th}}</div></td>
                  <td><div>{{item.company_province_th}}</div></td>
                </tr>
              </template>
              <template is="dom-if" if={{_checkData(company)}}>
                <tr>
                    <td colspan="4"><div class="text-table" style="margin:20px">{{localize.not_found}}</div></td>
                </tr>
              </template>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="horizontal justified layout" style="margin:20px;">
        <div>
          {{localize.company}}{{localize.all}} [[countCompany(list_search)]] {{localize.company}}
        </div>
        <div>
          {{localize.page}}
          <select id="selectedPage" on-change="selectPage">
              <template is="dom-repeat" items={{pages}}>
                  <option value="{{item}}">{{item}}</option>
              </template>
          </select>
          / [[countPage(pages)]] {{localize.page}}
        </div>
      </div>
    </paper-material>

    <panel-right title="{{titleName}}">
      <company-manage status-action="[[statusAction]]"></company-manage>
       <!-- hid-button="{{hidButton}}" is-enabled="{{isEnabled}}" -->
    </panel-right>

  </template>
  <script>
    Polymer({
      is: "page-company-edit",
      behaviors: [ReduxBehavior, nylonBehavior, companyAction],
      properties: {
        pages: {
          type: Number,
          notify: true,
          value: 0
        },
        data: {
          type: Object,
          value: {}
        },
        localize:{
          statePath : 'i18n.exporter'
        },
        company:{
          statePath : 'company.list'
        },
        pages:{
          statePath : 'company.pages'
        },
        list_search:{
          statePath : 'company.list_search'
        }
      },
      listeners: {
        'back-page': '_backPage'
      },
      nylonPageActive: function () {
        this.dispatchAction('COMPANY_GET_DATA');
        this.dispatchAction('COMPANY_GET_PAGE');
        this.dispatchAction('COMPANY_GET_DATA_SEARCH');
      },
      _checkID:function(id){
        if(id.detail.value !== ''){
          // console.log(id.detail.value);
          this.statusAction = 'edit';
          this.$$('panel-right').open();
          this.$$('company-manage').clearData(id.detail.value);
          this.titleName = 'แก้ไขข้อมูล';
        }
      },
      toIndex:function(index){
        return index+1;
      },
      _selectData:function(e){
        // console.log(e.currentTarget.data);
        var id = e.currentTarget.data.company_taxno;
        this.statusAction = 'edit';
        this.$$('panel-right').open();
        this.titleName = 'แก้ไขข้อมูล';
        this.$$('company-manage').clearData(id);
      },
      _add:function(){
        this.statusAction = 'add';
        // this.hidButton = true;
        // this.isEnabled = false;
        this.$$('panel-right').open();
        this.titleName = 'เพิ่มข้อมูล';
        this.dispatchAction('COMPANY_CLEAR_DATA');
        this.$$('company-manage').resetValidate();
      },
      _backPage:function(){
        this.$$('panel-right').close();
      },
      _checkData:function(val){
        if(val.length > 0){
          return false
        }else{
          return true
        }
      },
      selectPage: function(){
        var page = this.$$('#selectedPage').value;
        this.dispatchAction('COMPANY_GET_DATA', page);      
      },
      countPage: function(page){
        return page.length
      },
      countCompany: function(c){
        return numeral(c.length).format('0,0');
      }
    });
  </script>
</dom-module>